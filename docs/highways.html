<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clone Hero Viewer - Highways</title>

<link rel="stylesheet" href="nav_bar.css">
<link rel="stylesheet" href="index_bar.css">

<style>
html, body {
    overflow-x: hidden;  /* prevent horizontal scrolling */
}

.thumbnail-caption {
    word-break: break-word;
    display: block;
    overflow: visible;      /* allow full content */
    white-space: normal;    /* allow wrapping */
    text-overflow: clip;    /* prevent ellipsis */
}

/* Purple tooltip */
.tooltip {
    position: relative;
    display: inline-block;
}

.tooltip .tooltip-text {
    visibility: hidden;
    width: max-content;
    max-width: 250px;
    background-color: rgba(75,0,130,0.85);  /* deep purple */
    border: 1px solid #9370DB;               /* lighter purple border */
    color: #fff;
    text-align: left;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 12px;
    line-height: 1.3;
    position: absolute;
    z-index: 10;
    bottom: 105%;           /* above thumbnail */
    left: 50%;
    transform: translateX(-50%) translateY(-5px); /* small gap */
    opacity: 0;
    pointer-events: none;
    white-space: pre-line;
    transition: opacity 0.3s 0.5s;  /* fade in with delay */
}

.tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}

.thumbnail {
    position: relative;
}

.thumbnail::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: -6px;
    left: 50%;
    transform: translateX(calc(-50% + var(--tooltip-shift-x, 0px)));
    background: var(--accent-purple);          /* matches sidebar accent purple */
    color: #7b67ee;                             /* neutral gray text for DR on/off */
    padding: 6px 10px;
    border-radius: 6px;
    border: 2px solid var(--primary-purple);   /* thicker border matches sidebar */
    font-size: 14px;
    line-height: 1.3;
    white-space: pre;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease-in-out;
    z-index: 20;
}

.thumbnail:hover::after {
    opacity: 1;
    transition-delay: 0.5s;
}

</style>

</head>

<body>

<h1>Clone Hero Viewer - Highways <span id="highway-count"></span></h1>

<nav>
    <a href="index.html">Home</a>
    <a href="color_profiles.html">Color Profiles</a>
    <a href="highways.html">Highways</a>
    <a href="Image_bgs.html">Image Backgrounds</a>
    <a href="Video_bgs.html">Video Backgrounds</a>
    <a href="Video_highways.html">Video Highways</a>
	<div class="top-info">
	  <span id="scan-mode">Scan mode: <strong></strong></span>
	  <span id="highway-count"></span>
	</div>
</nav>

<!-- Sidebar -->
<div id="indexSidebar">

    <!-- Top row -->
    <div id="topRow">
        <!-- Numbers + Letters added via JS -->
    </div>

    <!-- Bottom row -->
    <div id="bottomRow">
        <input type="text" id="indexSearch" placeholder="Search">
        <span id="sliderLabel">Choose highway size:</span>
        <input type="range" id="thumbSizeSlider" min="0" max="11" value="0">
        <span id="thumbSizeValue"></span>
    </div>

</div>

<div id="highways" style="padding-bottom: 45px;"></div>

<script>
const slider = document.getElementById('thumbSizeSlider');
const sizeValue = document.getElementById('thumbSizeValue');
const columnSteps = [6,7,8,9,10,11,12,13,14,15,16,17];
const sizeLabels = [
    "Quantum Ant Man",
    "LEGO Emmet",
    "Sonic Screwdriver",
    "Minion",
    "Hobbit",
    "Wreck-it Ralph",
    "Smaug",
    "Stay-Puft Marshmallow Man",
    "Stark Tower",
    "Drej Mothership",
    "Death Star",
    "Gallifrey"
];

const indexSidebar = document.getElementById('indexSidebar');
const topRow = document.getElementById('topRow');
const bottomRow = document.getElementById('bottomRow');

/* ===== Numbers button ===== */
const numbersBtn = document.createElement('div');
numbersBtn.textContent = '0-9';
numbersBtn.dataset.letter = '0-9';
numbersBtn.className = 'indexButton';
topRow.appendChild(numbersBtn);

/* ===== Letter buttons ===== */
const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
letters.forEach(l => {
    const btn = document.createElement('div');
    btn.textContent = l;
    btn.dataset.letter = l;
    btn.className = 'indexButton';
    topRow.appendChild(btn);
});

/* ===== Back to top button ===== */
const topBtn = document.createElement('div');
topBtn.textContent = '(â†‘)';
topBtn.title = 'Back to top';
topBtn.className = 'indexButton topButton';
topBtn.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
});
topRow.appendChild(topBtn);

/* ===== Load thumbnails ===== */
fetch('scan_summary.json')
.then(r => r.json())
.then(data => {
    const container = document.getElementById('highways');

    data.thumbnails.forEach(item => {
        const card = document.createElement('div');
        card.className = 'thumbnail';
        card.dataset.filename = item.file.toUpperCase();

        // Add class for transparent PNGs
        if (item.transparent) {
            card.classList.add('transparent');
        }

        const box = document.createElement('div');
        box.className = 'thumbnail-box';

        const img = document.createElement('img');
        img.src = './' + item.thumbnail;
        box.appendChild(img);

        const caption = document.createElement('div');
		caption.className = 'thumbnail-caption';
		caption.textContent = item.file.replace(/\.[^/.]+$/, '');

		// Step 1: Add tooltip showing filename + file type
		const fileType = item.file.split('.').pop().toUpperCase();
		const fileName = item.file.replace(/\.[^/.]+$/, ''); // remove extension
		const fileSizeKB = (item.size / 1024); // assuming item.size is in bytes
		const fileSizeText = fileSizeKB.toLocaleString('en-US', {minimumFractionDigits: 1, maximumFractionDigits: 1}); 
		card.setAttribute(
  'data-tooltip',
  `File: ${fileName}
File Type: ${fileType}
File Size: ${fileSizeText} KB
Resolution: ${item.width}x${item.height}
Transparency: ${item.transparent ? 'Yes' : 'No'}`
);


        const btn = document.createElement('button');
        btn.className = 'download-btn';
        btn.textContent = 'Download';
        btn.onclick = () => {
            const a = document.createElement('a');
            a.href = './' + item.file;
            a.download = item.file;
            a.click();
        };

        card.append(box, caption, btn);
		container.appendChild(card);
		// Tooltip edge correction
		card.addEventListener('mouseenter', () => {
			const tooltipText = card.getAttribute('data-tooltip');
			if (!tooltipText) return;

			// Create a temporary measurement tooltip
			const temp = document.createElement('div');
			temp.textContent = tooltipText;
			temp.style.position = 'fixed';
			temp.style.visibility = 'hidden';
			temp.style.whiteSpace = 'pre';
			temp.style.fontSize = '14px';
			temp.style.padding = '6px 10px';
			document.body.appendChild(temp);

			const rect = card.getBoundingClientRect();
			const tooltipWidth = temp.offsetWidth;
			const viewportWidth = window.innerWidth;

			let shift = 0;
			const tooltipLeft = rect.left + rect.width / 2 - tooltipWidth / 2;
			const tooltipRight = tooltipLeft + tooltipWidth;

			if (tooltipLeft < 8) {
				shift = (12 - tooltipLeft);
			} else if (tooltipRight > viewportWidth - 8) {
				shift = (viewportWidth - 12 - tooltipRight);
			}

			card.style.setProperty('--tooltip-shift-x', `${shift}px`);
			document.body.removeChild(temp);
		});

		card.addEventListener('mouseleave', () => {
			card.style.removeProperty('--tooltip-shift-x');
		});

	});

    /* ===== Thumbnail sizing ===== */
    function updateThumbnailSizes() {
        const columns = columnSteps[columnSteps.length - 1 - slider.value];
        const gap = 10;
        const w = (container.clientWidth - gap * (columns - 1)) / columns;
        const h = w * 2;

        container.style.gridTemplateColumns =
            `repeat(auto-fill, minmax(${w}px, 1fr))`;

        document.querySelectorAll('.thumbnail-box, .thumbnail-box img')
            .forEach(el => {
                el.style.width = w + 'px';
                el.style.height = h + 'px';
            });

        sizeValue.textContent = sizeLabels[slider.value];
    }

    slider.value = 0;
    updateThumbnailSizes();
    slider.addEventListener('input', updateThumbnailSizes);
    window.addEventListener('resize', updateThumbnailSizes);

    /* ===== Sidebar navigation ===== */
    topRow.querySelectorAll('.indexButton').forEach(btn => {
        btn.addEventListener('click', () => {
            const targetLetter = btn.dataset.letter;
            let found = null;

            const thumbs = container.querySelectorAll('.thumbnail');
            thumbs.forEach(t => {
                const firstChar = t.dataset.filename[0];
                if (
                    targetLetter === '0-9' && /\d/.test(firstChar) && !found ||
                    firstChar === targetLetter && !found
                ) {
                    found = t;
                }
            });

            if (found) {
                found.scrollIntoView({ behavior: 'smooth', block: 'start' });

                const box = found.querySelector('.thumbnail-box');
                box.classList.remove('flash');
                void box.offsetWidth;
                box.classList.add('flash');
                setTimeout(() => {
                    box.classList.remove('flash');
                }, 2500);

            } else {
                // Only apply shake/red to letter buttons, not up arrow
                if (btn.dataset.letter) {
                    btn.classList.remove('shake');
                    void btn.offsetWidth;
                    btn.classList.add('shake', 'red');
                    setTimeout(() => {
                        btn.classList.remove('shake', 'red');
                    }, 1000);
                }
            }

        });
    });

    /* ===== Search ===== */
    const searchInput = document.getElementById('indexSearch');
    searchInput.addEventListener('input', () => {
        const query = searchInput.value.toUpperCase();
        container.querySelectorAll('.thumbnail').forEach(t => {
            t.style.display =
                t.dataset.filename.includes(query) ? '' : 'none';
        });
    });

})
.catch(err => {
    console.error(err);
    document.getElementById('highways').textContent =
        'Error loading scan_summary.json';
});
</script>

<script>
fetch('scan_summary.json')
    .then(res => res.json())
    .then(data => {
        const count = data.thumbnails.length; // number of highways
        document.getElementById('highway-count').innerText = `(${count.toLocaleString('en-US')})`;
		let scanModeText = 'Unknown';

		if (data.scan_mode === 'T') scanModeText = 'Test';
		else if (data.scan_mode === 'A') scanModeText = 'Actual';
		else if (data.scan_mode === 'B') scanModeText = 'Both';

		document.querySelector('#scan-mode strong').innerText = scanModeText;

    })
    .catch(err => console.error('Error loading scan_summary.json:', err));
</script>

</body>
</html>
