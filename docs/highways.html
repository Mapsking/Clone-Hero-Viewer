<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clone Hero Viewer - Highways</title>

<link rel="stylesheet" href="nav_bar.css">
<link rel="stylesheet" href="index_bar.css">

<style>
html, body {
    overflow-x: hidden;  /* prevent horizontal scrolling */
}

.thumbnail-caption {
    word-break: break-word;
    display: block;
    overflow: visible;      /* allow full content */
    white-space: normal;    /* allow wrapping */
    text-overflow: clip;    /* prevent ellipsis */
}

/* Purple tooltip */
.tooltip {
    position: relative;
    display: inline-block;
}

.tooltip .tooltip-text {
    visibility: hidden;
    width: max-content;
    max-width: 250px;
    background-color: rgba(75,0,130,0.85);  /* deep purple */
    border: 1px solid #9370DB;               /* lighter purple border */
    color: #fff;
    text-align: left;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 12px;
    line-height: 1.3;
    position: absolute;
    z-index: 10;
    bottom: 105%;           /* above thumbnail */
    left: 50%;
    transform: translateX(-50%) translateY(-5px); /* small gap */
    opacity: 0;
    pointer-events: none;
    white-space: pre-line;
    transition: opacity 0.3s 0.5s;  /* fade in with delay */
}

.tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
	bottom: 25%; /* move tooltip higher so it doesn't cover the download button */
}

.thumbnail {
    position: relative;
}

/* Anchor indicator to image box */
.thumbnail-box {
    position: relative;
}

/* Transparent Indicator - anchored to thumbnail-box */
.transparent-indicator {
    position: absolute;
    top: 4px;
    right: 4px;
    width: 30%;
    aspect-ratio: 1 / 1;
    box-sizing: border-box;
    border: 3px solid #6f63d8;
    border-radius: 45px;   /* forces true circle at all sizes */
    z-index: 25;
    pointer-events: none;
    background-color: #333;
    background-image: repeating-conic-gradient(
        #333 0deg 90deg,
        #777 0deg 180deg
    );
	box-shadow: 0 0 0 1px rgba(0,0,0,0.35);
    background-size: 50% 50%;
}

</style>

</head>

<body>

<h1>Clone Hero Viewer - Highways <span id="highway-count"></span></h1>

<nav>
    <a href="index.html">Home</a>
    <a href="color_profiles.html">Color Profiles</a>
    <a href="highways.html">Highways</a>
    <a href="Image_bgs.html">Image Backgrounds</a>
    <a href="Video_bgs.html">Video Backgrounds</a>
    <a href="Video_highways.html">Video Highways</a>
	<div class="top-info">
	  <span id="scan-mode">Scan mode: <strong></strong></span>
	  <span id="highway-count"></span>
	</div>
</nav>

<!-- Sidebar -->
<div id="indexSidebar">

    <!-- Top row -->
    <div id="topRow">
        <!-- Numbers + Letters added via JS -->
    </div>

    <!-- Bottom row -->
    <div id="bottomRow">
        <input type="text" id="indexSearch" placeholder="Search">
        <span id="sliderLabel">Choose highway size:</span>
        <input type="range" id="thumbSizeSlider" min="0" max="11" value="0">
        <span id="thumbSizeValue"></span>
    </div>

</div>

<div id="highways" style="padding-bottom: 45px;"></div>

<script>
const slider = document.getElementById('thumbSizeSlider');
const sizeValue = document.getElementById('thumbSizeValue');
const columnSteps = [6,7,8,9,10,11,12,13,14,15,16,17];
const sizeLabels = [
    "Quantum Ant Man",
    "LEGO Emmet",
    "Sonic Screwdriver",
    "Minion",
    "Hobbit",
    "Wreck-it Ralph",
    "Smaug",
    "Stay-Puft Marshmallow Man",
    "Stark Tower",
    "Drej Mothership",
    "Death Star",
    "Gallifrey"
];

const indexSidebar = document.getElementById('indexSidebar');
const topRow = document.getElementById('topRow');
const bottomRow = document.getElementById('bottomRow');

/* ===== Numbers button ===== */
const numbersBtn = document.createElement('div');
numbersBtn.textContent = '0-9';
numbersBtn.dataset.letter = '0-9';
numbersBtn.className = 'indexButton';
topRow.appendChild(numbersBtn);

/* ===== Letter buttons ===== */
const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
letters.forEach(l => {
    const btn = document.createElement('div');
    btn.textContent = l;
    btn.dataset.letter = l;
    btn.className = 'indexButton';
    topRow.appendChild(btn);
});

/* ===== Back to top button ===== */
const topBtn = document.createElement('div');
topBtn.textContent = '(↑)';
topBtn.title = 'Back to top';
topBtn.className = 'indexButton topButton';
topBtn.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
});
topRow.appendChild(topBtn);

/* ===== Load thumbnails ===== */
fetch('scan_summary.json')
.then(r => r.json())
.then(data => {
    const container = document.getElementById('highways');

    data.thumbnails.forEach(item => {
        const card = document.createElement('div');
        card.className = 'thumbnail';
        card.dataset.filename = item.file.toUpperCase();

        // Add class for transparent PNGs
        if (item.transparent) {
            card.classList.add('transparent');
        }

        const box = document.createElement('div');
        box.className = 'thumbnail-box';

		const img = document.createElement('img');
		img.src = './thumbnails/' + item.file;
		box.appendChild(img);

		const caption = document.createElement('div');
		caption.className = 'thumbnail-caption';
		caption.textContent = item.file.replace(/\.[^/.]+$/, '');

		// Step 1: Add tooltip showing filename + file type
		const fileType = item.file.split('.').pop().toUpperCase();
		const fileName = item.file.replace(/\.[^/.]+$/, ''); // remove extension
		const fileSizeKB = (item.size / 1024); // assuming item.size is in bytes
		const fileSizeText = fileSizeKB.toLocaleString('en-US', {minimumFractionDigits: 1, maximumFractionDigits: 1}); 
		card.setAttribute('data-tooltip', 'TEST TOOLTIP');
		card.setAttribute(
		  'data-tooltip',
		  `File: ${fileName}\nFile Type: ${fileType}\nFile Size: ${fileSizeText} KB\nResolution: ${item.width}x${item.height}\nTransparency: ${item.transparent ? 'Yes' : 'No'}`
		);

		const btn = document.createElement('button');
		btn.className = 'download-btn';
		btn.textContent = 'Download';
		btn.addEventListener('click', async () => {
			try {
				const response = await fetch(`https://pub-e51c5afbba664a45ac4c4795c2758200.r2.dev/Highways/${item.file}`);
				if (!response.ok) throw new Error('Network response was not ok');
				const blob = await response.blob();
				const url = URL.createObjectURL(blob);

				const a = document.createElement('a');
				a.href = url;
				a.download = item.file;
				a.click();

				URL.revokeObjectURL(url);  // clean up memory
			} catch (err) {
				console.error('Download failed:', err);
				alert('Download failed. See console for details.');
			}
		});

        card.append(box, caption, btn);

		// Add transparent indicator if needed
		if (item.transparent) {
			const indicator = document.createElement('div');
			indicator.className = 'transparent-indicator';
			box.appendChild(indicator);
		}

		container.appendChild(card);
		// Tooltip edge correction with stable positioning
		let activeTooltip = null;
		let tooltipTimeout = null;

		card.addEventListener('mouseenter', () => {
			const tooltipText = card.getAttribute('data-tooltip');
			if (!tooltipText) return;

			const tooltip = document.createElement('div');
			tooltip.className = 'tooltip-text';
			tooltip.textContent = tooltipText;

			Object.assign(tooltip.style, {
				position: 'absolute',
				pointerEvents: 'none',
				background: 'var(--accent-purple)',
				color: '#7b67ee',
				padding: '6px 10px',
				border: '2px solid var(--primary-purple)',
				borderRadius: '6px',
				fontSize: '14px',
				lineHeight: '1.3',
				whiteSpace: 'pre',
				textAlign: 'left',
				zIndex: '999',
				opacity: '0',
				transition: 'opacity .6s ease-in-out'
			});

			document.body.appendChild(tooltip);
			activeTooltip = tooltip;

			tooltipTimeout = setTimeout(() => tooltip.style.opacity = '1', 50);

			// Position tooltip near the bottom of the thumbnail (above download button)
			const rect = card.getBoundingClientRect();
			const scrollY = window.scrollY || window.pageYOffset;
			const scrollX = window.scrollX || window.pageXOffset;

			let left = rect.left + scrollX + rect.width / 2 - tooltip.offsetWidth / 2;
			let top = rect.top + scrollY + rect.height - tooltip.offsetHeight - 25; // near bottom

			if (left < 8) left = 8;
			if (left + tooltip.offsetWidth > window.innerWidth - 8) {
				left = window.innerWidth - tooltip.offsetWidth - 8;
			}

			tooltip.style.left = left + 'px';
			tooltip.style.top = top + 'px';
		});

		card.addEventListener('mouseleave', () => {
			if (tooltipTimeout) clearTimeout(tooltipTimeout);

			if (activeTooltip) {
				activeTooltip.style.opacity = '0';
				setTimeout(() => {
					if (activeTooltip && activeTooltip.parentNode) {
						activeTooltip.parentNode.removeChild(activeTooltip);
						activeTooltip = null;
					}
				}, 250);
			}
		});


	});

    /* ===== Thumbnail sizing ===== */
    function updateThumbnailSizes() {
        const columns = columnSteps[columnSteps.length - 1 - slider.value];
        const gap = 10;
        const w = (container.clientWidth - gap * (columns - 1)) / columns;
        const h = w * 2;

        container.style.gridTemplateColumns =
            `repeat(auto-fill, minmax(${w}px, 1fr))`;

        document.querySelectorAll('.thumbnail-box, .thumbnail-box img')
            .forEach(el => {
                el.style.width = w + 'px';
                el.style.height = h + 'px';
            });

        sizeValue.textContent = sizeLabels[slider.value];
    }

    slider.value = 0;
    updateThumbnailSizes();
    slider.addEventListener('input', updateThumbnailSizes);
    window.addEventListener('resize', updateThumbnailSizes);

    /* ===== Sidebar navigation ===== */
    topRow.querySelectorAll('.indexButton').forEach(btn => {
        btn.addEventListener('click', () => {
            const targetLetter = btn.dataset.letter;
            let found = null;

            const thumbs = container.querySelectorAll('.thumbnail');
            thumbs.forEach(t => {
                const firstChar = t.dataset.filename[0];
                if (
                    targetLetter === '0-9' && /\d/.test(firstChar) && !found ||
                    firstChar === targetLetter && !found
                ) {
                    found = t;
                }
            });

            if (found) {
                found.scrollIntoView({ behavior: 'smooth', block: 'start' });

                const box = found.querySelector('.thumbnail-box');
                box.classList.remove('flash');
                void box.offsetWidth;
                box.classList.add('flash');
                setTimeout(() => {
                    box.classList.remove('flash');
                }, 2500);

            } else {
                // Only apply shake/red to letter buttons, not up arrow
                if (btn.dataset.letter) {
                    btn.classList.remove('shake');
                    void btn.offsetWidth;
                    btn.classList.add('shake', 'red');
                    setTimeout(() => {
                        btn.classList.remove('shake', 'red');
                    }, 1000);
                }
            }

        });
    });

    /* ===== Search ===== */
    const searchInput = document.getElementById('indexSearch');
    searchInput.addEventListener('input', () => {
    const query = searchInput.value.toUpperCase();
    container.querySelectorAll('.thumbnail').forEach(t => {
        t.style.display =
            t.dataset.filename.includes(query) ? '' : 'none';
    });
});

// Clear search on ESC key instantly
searchInput.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        searchInput.value = '';
        container.querySelectorAll('.thumbnail').forEach(t => t.style.display = '');
    }
});

})
.catch(err => {
    console.error(err);
    document.getElementById('highways').textContent =
        'Error loading scan_summary.json';
});
</script>

<script>
fetch('scan_summary.json')
    .then(res => res.json())
    .then(data => {
        const count = data.thumbnails.length; // number of highways
        document.getElementById('highway-count').innerText = `(${count.toLocaleString('en-US')})`;
		let scanModeText = 'Unknown';

		if (data.scan_mode === 'T') scanModeText = 'Test';
		else if (data.scan_mode === 'A') scanModeText = 'Actual';
		else if (data.scan_mode === 'B') scanModeText = 'Both';

		document.querySelector('#scan-mode strong').innerText = scanModeText;

    })
    .catch(err => console.error('Error loading scan_summary.json:', err));

  // … your existing code …

  const searchInput = document.getElementById('indexSearch');

  // CTRL+F override
  document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 'f') {
          e.preventDefault();            // stop browser default
          searchInput.focus();           // move focus to your search box
          searchInput.select();          // optionally select the text
      }
  });
</script>
</body>
</html>
